generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Contact {
  userId                       String
  contactId                    String
  categoryId                   String?
  status                       ContactStatus    @default(PENDING)
  createdAt                    DateTime         @default(now())
  updatedAt                    DateTime         @updatedAt
  ContactCategory              ContactCategory? @relation(fields: [categoryId], references: [id])
  User_Contact_contactIdToUser User             @relation("Contact_contactIdToUser", fields: [contactId], references: [id], onDelete: Cascade)
  User_Contact_userIdToUser    User             @relation("Contact_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, contactId])
  @@index([categoryId])
  @@index([contactId])
  @@index([userId])
}

model ContactCategory {
  id                String              @id @default(cuid())
  userId            String
  name              String
  color             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  Contact           Contact[]
  User              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  HangoutVisibility HangoutVisibility[]

  @@unique([userId, name])
  @@index([userId])
}

model Hangout {
  id                String              @id @default(cuid())
  userId            String
  title             String
  description       String?
  location          String?
  latitude          Float?
  longitude         Float?
  startsAt          DateTime
  endsAt            DateTime?
  isPublic          Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  User              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  HangoutVisibility HangoutVisibility[]

  @@index([isPublic])
  @@index([latitude, longitude])
  @@index([startsAt])
  @@index([userId])
}

model HangoutVisibility {
  id              String           @id @default(cuid())
  hangoutId       String
  categoryId      String?
  userId          String?
  createdAt       DateTime         @default(now())
  ContactCategory ContactCategory? @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  Hangout         Hangout          @relation(fields: [hangoutId], references: [id], onDelete: Cascade)
  User            User?            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([hangoutId])
  @@index([userId])
}

model Interest {
  id           String         @id @default(cuid())
  name         String         @unique
  description  String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  UserInterest UserInterest[]
}

model User {
  id                              String              @id @default(cuid())
  firebaseUid                     String              @unique
  email                           String?             @unique
  displayName                     String?
  photoUrl                        String?
  createdAt                       DateTime            @default(now())
  updatedAt                       DateTime            @updatedAt
  Contact_Contact_contactIdToUser Contact[]           @relation("Contact_contactIdToUser")
  Contact_Contact_userIdToUser    Contact[]           @relation("Contact_userIdToUser")
  ContactCategory                 ContactCategory[]
  Hangout                         Hangout[]
  HangoutVisibility               HangoutVisibility[]
  UserInterest                    UserInterest[]

  @@index([email])
  @@index([firebaseUid])
}

model UserInterest {
  userId     String
  interestId String
  createdAt  DateTime @default(now())
  Interest   Interest @relation(fields: [interestId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, interestId])
  @@index([interestId])
  @@index([userId])
}

enum ContactStatus {
  PENDING
  ACCEPTED
}
